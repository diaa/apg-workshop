---
sectionid: SQLCharacteristic
sectionclass: h2
parent-id: day2
title: SQL Characteristic

---
### Partial Index
Let's create a new table in quiz database and load it with some data:
```sql 
CREATE SCHEMA IF NOT EXISTS games;
SET SEARCH_PATH TO games;
DROP TABLE IF EXISTS games;
CREATE TABLE games
(
    id         BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    start_time TIMESTAMP NOT NULL DEFAULT now(),
    end_time   TIMESTAMP NOT NULL,
    players    INTEGER[] NOT NULL,
    winner     INTEGER,
    is_activ   BOOLEAN            DEFAULT TRUE
);

INSERT INTO games (start_time, end_time, players, winner, is_activ)
SELECT d, d + '1 hour', ('{' || n || ',' || n + 4 || '}')::INT[], n, TRUE
FROM generate_series(1, 10000) n,
     generate_series('2021-01-01'::TIMESTAMP, now()::TIMESTAMP, '1 day'::INTERVAL) d
;
```

Check how many rows were added:
```sql
SELECT count(*) FROM games;
```

Update some of the rows so is_activ field will have value FALSE for all the rows where start_time is different than today:
```sql
UPDATE games SET is_activ = FALSE WHERE start_time::date <> CURRENT_DATE;
```

Check how many of the rows have flag is_activ set to TRUE:
```sql
SELECT count(*) FROM games WHERE is_activ;
```

Run the same query 4-5 times again and check it's execution time:
```sql
SELECT count(*) FROM games WHERE is_activ;
```

Were subsequent executions faster than the first and could you explain why?

Let's create a partial index using is_activ column:
```sql 
CREATE INDEX ON games(id) WHERE is_activ;
```

Check again how much time this query needs to be executed:
```sql
SELECT count(*) FROM games WHERE is_activ;
```

### JSONB
Create a table containing JSONB column and populate it with some data:
```sql
CREATE TABLE products
(
    name       TEXT,
    attributes JSONB
);

INSERT INTO products (name, attributes)
VALUES ('Leffe Blonde Ale',
        '{
          "category": "Golden / Blonde Ale",
          "region": "Belgium",
          "ABV": 6.6
        }');
```

Query the table using JSON operators:

```sql
SELECT name, attributes -> 'ABV'
FROM products;

SELECT name, attributes ->> 'ABV'
FROM products
WHERE attributes ->> 'region' = 'Belgium';
```

Create the GIN index on the table:
```sql
CREATE INDEX ON products USING gin(attributes);
```





